<% layout('../layout') -%>
<div class="content-page">
    <!-- Start content -->
    <div class="content">
        <div class="container">

            <!-- Page-Title -->
            <div class="row">
                <div class="col-sm-12">
                    <h4 class="page-title">Customers</h4>
                    <ol class="breadcrumb">
                        <li>
                            <a href="#">Admin</a>
                        </li>
                        <li>
                            <a href="#">Manage</a>
                        </li>
                        <li class="active">
                            <%= user.role%>
                        </li>
                        <li class="active">
                            Announce
                        </li>
                    </ol>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="card-box table-responsive">
                        <h4 class="m-t-0 header-title"><b>History</b></h4>
                        <p class="text-muted font-13 m-b-30">
                            In this example the column index is prefixed to the column title.
                        </p>

                        <table id="datatable-fixed-col" class="table table-striped table-bordered">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>Sender</th>
                                <th>Title</th>
                                <th>Content</th>
                                <th>Priority</th>
                                <th>Receiver</th>
                                <th>Created At</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div> <!-- end col -->
            </div>
        </div> <!-- container -->

    </div> <!-- content -->
    <footer class="footer text-right">
        Â© 2017. All rights reserved.
    </footer>
</div>




<script>
    $(document).ready(function () {

        var table = $('#datatable-fixed-col').dataTable({
            processing:true,
            serverSide: true,
            autoWidth: true,
            ajax: '/department/manage/announce/history/data-table?sender=<%= user._id%>',
            columnDefs: [{
                "targets": -1,
                "data": null,
            }],
            columns:[
                {data: '_id', name: '_id',"visible": false},
                {data: 'sender', name: 'sender',visible: false},
                {data: 'title', name: 'title',searchable: true, type: "string",
                    fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                        $(nTd).html("<a href='/department/manage/announce/"+oData._id+"'>"+oData.title+"</a>");
                }},
                {data: 'content',name :'content',searchable: true,
                    fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                        $(nTd).html("<a href='/department/manage/announce/"+oData._id+"'>"+oData.content+"</a>")}},
                {data: 'priorityNotify.name',name : 'priority',},
                {data: 'kindOfReceiver',name : 'kindOfReceiver',},
                {data: 'createdAt', name: 'createdAt'},

            ],
        });
        table
            .columns( '.sender' )
            .search( '<%= user._id%>' )
            .draw();
    });

</script>
